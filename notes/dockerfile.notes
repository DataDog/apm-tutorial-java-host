FROM openjdk:11 as build

RUN apt-get update -y; apt-get install curl -y

WORKDIR /home/apm-tutorial-java

RUN curl -Lo dd-java-agent.jar https://dtdg.co/latest-java-tracer 
COPY notes notes/  

WORKDIR /home/apm-tutorial-java/notes

# Uncomment to compile with maven
RUN ./mvnw clean
RUN ./mvnw package
ENTRYPOINT ["java" , "-javaagent:../dd-java-agent.jar", "-XX:FlightRecorderOptions=stackdepth=256" , "-Ddd.trace.sample.rate=1" ,"-Ddd.service=notes" ,"-Ddd.env=dev" , "-Ddd.version=0.0.1" , "-jar" , "target/notes-0.0.1-SNAPSHOT.jar"]  

# Uncomment to compile with gradle
#RUN ./gradlew clean
#RUN ./gradlew shadowJar
#ENTRYPOINT ["java","-javaagent:../dd-java-agent.jar", "-Ddd.trace.sample.rate=1" , "-Ddd.service=notes" , "-Ddd.env=dev" , "-Ddd.version=0.0.1", "-jar" , "build/libs/notes-0.0.1-SNAPSHOT-all.jar"]

